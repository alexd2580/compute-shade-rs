<!DOCTYPE html>

<html>

<head>
    <style>
        body {
            width: 100%;
            height: 100%;
        }

        .splitv {
            width: 100%;
            height: 100%;
            display: flex;
            flex-flow: column nowrap;
        }

        .splith {
            width: 100%;
            height: 100%;
            display: flex;
            flex-flow: row nowrap;
        }

        .graph {
            <!-- width: 100%; -->
            <!-- height: 100%; -->
        }
    </style>

    <script type="module">
        import * as chartjs from "https://cdn.jsdelivr.net/npm/chart.js";

        function createChart(index) {
            const canvas = document.getElementById(`chart${index}`);
            return new Chart(canvas, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: `${index}`,
                        data: [],
                    }]
                },
            });
        }

        const charts = [
            createChart(0),
            createChart(1),
            createChart(2),
            createChart(3),
        ];

        let sampleIndex = 0;
        const source = new EventSource("http://127.0.0.1:3000/event");
        source.onmessage = function (event) {
            const sample = JSON.parse(event.data);
            charts.forEach((chart, index) => {
                const {labels, datasets} = chart.data;

                chart.data.labels.push(sampleIndex);
                datasets[0].data.push(sample[index]);

                if (labels.length > 250) {
                    labels.shift();
                    datasets[0].data.shift();
                }
            });
            sampleIndex++;
        };

        setInterval(() => {
            charts.forEach(chart => chart.update("none"));
        }, 25);
    </script>

</head>

<body>
    <div class="splitv">
        <div class="splith">
            <canvas id="chart0" class=".chart"></canvas>
            <canvas id="chart1" class=".chart"></canvas>
        </div>
        <div class="splith">
            <canvas id="chart2" class=".chart"></canvas>
            <canvas id="chart3" class=".chart"></canvas>
        </div>
    </div>
</body>

</html>




<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!--  -->
<!-- <script type="module"> -->
<!--     import * as echarts from 'https://cdn.jsdelivr.net/npm/echarts@5.4.3/+esm'; -->
<!--  -->
<!--     const element = document.getElementById('container'); -->
<!--     const options = {renderer: 'svg'}; -->
<!--     const chart = echarts.init(element, null, options); -->
<!--     var option; -->
<!--  -->
<!--     var x = [0]; -->
<!--     var y = [1]; -->
<!--  -->
<!--     for (var i = 1; i < 100; i++) { -->
<!--         addData(); -->
<!--     } -->
<!--  -->
<!--     option = { -->
<!--         xAxis: { -->
<!--             type: 'category', -->
<!--             boundaryGap: false, -->
<!--             data: date -->
<!--         }, -->
<!--         yAxis: { -->
<!--             boundaryGap: [0, '50%'], -->
<!--             type: 'value' -->
<!--         }, -->
<!--         series: [ -->
<!--             { -->
<!--                 name: 'Y', -->
<!--                 type: 'line', -->
<!--                 smooth: true, -->
<!--                 symbol: 'none', -->
<!--                 stack: 'a', -->
<!--                 areaStyle: { -->
<!--                     normal: {} -->
<!--                 }, -->
<!--                 data: data -->
<!--             } -->
<!--         ] -->
<!--     }; -->
<!--  -->
<!--     setInterval(function () { -->
<!--     }, 500); -->
<!--  -->
<!--  -->
<!--     function addData(shift) { -->
<!--         now = [now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'); -->
<!--         date.push(now); -->
<!--         data.push((Math.random() - 0.4) * 10 + data[data.length - 1]); -->
<!--         if (shift) { -->
<!--             date.shift(); -->
<!--             data.shift(); -->
<!--         } -->
<!--         now = new Date(+new Date(now) + oneDay); -->
<!--     } -->
<!--  -->
<!--     option &#38;&#38; chart.setOption(option); -->
<!--  -->
<!--     // const source = new EventSource("http://127.0.0.1:3000/event"); -->
<!--     // source.onmessage = function (event) { -->
<!--     //     const sample = JSON.parse(event.data); -->
<!--     //     data.push(sample[0]); -->
<!--  -->
<!--         // chart.setOption({ -->
<!--         //     xAxis: { -->
<!--         //         data: date -->
<!--         //     }, -->
<!--         //     series: [ -->
<!--         //         { -->
<!--         //             name: '成交', -->
<!--         //             data: data -->
<!--         //         } -->
<!--         //     ] -->
<!--         // }); -->
<!--  -->
<!--     //     d3.select(this) -->
<!--     //         .attr("d", line) -->
<!--     //         .attr("transform", null); -->
<!--  -->
<!--     //     data.shift(); -->
<!--     // }; -->
<!-- </script> -->
